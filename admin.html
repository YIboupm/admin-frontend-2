<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理后台 - LingualAudio</title>
    <link rel="stylesheet" href="css/admin.css">
    <link rel="stylesheet" href="css/questions.css">  <!-- 新增 -->
    
    <link rel="stylesheet" href="css/listening_admin.css">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="admin-layout">
        <!-- 侧边栏 -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="24" cy="24" r="20" stroke="currentColor" stroke-width="2"/>
                        <path d="M16 20C16 20 20 16 24 16C28 16 32 20 32 20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <circle cx="18" cy="26" r="2" fill="currentColor"/>
                        <circle cx="30" cy="26" r="2" fill="currentColor"/>
                        <path d="M20 32C20 32 22 34 24 34C26 34 28 32 28 32" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <span>LingualAudio</span>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">主要功能</div>
                    <a href="#dashboard" class="nav-item active" data-page="dashboard">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="9"/>
                            <rect x="14" y="3" width="7" height="5"/>
                            <rect x="14" y="12" width="7" height="9"/>
                            <rect x="3" y="16" width="7" height="5"/>
                        </svg>
                        <span>仪表盘</span>
                    </a>
                    <a href="#writing" class="nav-item" data-page="writing">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                        </svg>
                        <span>写作任务</span>
                    </a>
                    <a href="#listening" class="nav-item" data-page="listening">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2C8 2 2 4 2 10c0 7 10 12 10 12s10-5 10-12c0-6-6-8-10-8z"/>
                            <circle cx="12" cy="10" r="3"/>
                        </svg>
                        <span>听力管理</span>
                    </a>
                    <a href="#reading" class="nav-item" data-page="reading">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                        </svg>
                        <span>阅读材料</span>
                    </a>
                    <a href="#stories" class="nav-item" data-page="stories">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                        </svg>
                        <span>故事管理</span>
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">内容管理</div>
                    <a href="#places" class="nav-item" data-page="places">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                            <circle cx="12" cy="10" r="3"/>
                        </svg>
                        <span>旅游地点</span>
                    </a>
                    <a href="#countries" class="nav-item" data-page="countries">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="2" y1="12" x2="22" y2="12"/>
                            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                        </svg>
                        <span>国家/城市</span>
                    </a>
                </div>
            </nav>
            
            <div class="sidebar-footer">
                <div class="user-info" id="userInfo">
                    <div class="user-avatar">
                        <span id="userInitial">A</span>
                    </div>
                    <div class="user-details">
                        <span class="user-name" id="userName">管理员</span>
                        <span class="user-role">Administrator</span>
                    </div>
                </div>
                <button class="btn-logout" id="logoutBtn" title="退出登录">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                        <polyline points="16 17 21 12 16 7"/>
                        <line x1="21" y1="12" x2="9" y2="12"/>
                    </svg>
                </button>
            </div>
        </aside>

        <!-- 主内容区 -->
        <main class="main-content">
            <!-- 顶部栏 -->
            <header class="top-bar">
                <button class="menu-toggle" id="menuToggle">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="12" x2="21" y2="12"/>
                        <line x1="3" y1="6" x2="21" y2="6"/>
                        <line x1="3" y1="18" x2="21" y2="18"/>
                    </svg>
                </button>
                <div class="page-title" id="pageTitle">仪表盘</div>
                <div class="top-bar-actions">
                    <div class="search-box">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                        </svg>
                        <input type="text" placeholder="搜索..." id="globalSearch">
                    </div>
                </div>
            </header>

            <!-- 内容页面容器 -->
            <div class="content-wrapper" id="contentWrapper">
                <!-- 仪表盘页面 -->
                <section class="page-content active" id="page-dashboard">
                    <div class="dashboard-stats">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #e94560 0%, #ff6b6b 100%);">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                </svg>
                            </div>
                            <div class="stat-info">
                                <span class="stat-value" id="statWritingTasks">-</span>
                                <span class="stat-label">写作任务</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #3498db 0%, #5dade2 100%);">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                                </svg>
                            </div>
                            <div class="stat-info">
                                <span class="stat-value" id="statReadingPassages">-</span>
                                <span class="stat-label">阅读材料</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #f4a261 0%, #e9c46a 100%);">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                                </svg>
                            </div>
                            <div class="stat-info">
                                <span class="stat-value" id="statStories">-</span>
                                <span class="stat-label">故事数量</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                    <circle cx="12" cy="10" r="3"/>
                                </svg>
                            </div>
                            <div class="stat-info">
                                <span class="stat-value" id="statPlaces">-</span>
                                <span class="stat-label">旅游地点</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-welcome">
                        <h2>欢迎回来！</h2>
                        <p>使用左侧导航栏管理您的西班牙语学习内容。</p>
                    </div>
                </section>

                <!-- 写作任务页面 -->
                <section class="page-content" id="page-writing">
                    <div class="page-header">
                        <div class="page-header-left">
                            <h2>写作任务管理</h2>
                            <p>创建和管理 DELE/SIELE 写作练习题</p>
                        </div>
                        <div class="page-header-right">
                            <button class="btn btn-primary" id="btnAddWritingTask">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"/>
                                    <line x1="5" y1="12" x2="19" y2="12"/>
                                </svg>
                                <span>新建任务</span>
                            </button>
                        </div>
                    </div>

                    <!-- 筛选栏 -->
                    <div class="filter-bar">
                        <div class="filter-group">
                            <label>考试类型</label>
                            <select id="filterExamType" class="filter-select">
                                <option value="">全部</option>
                                <option value="DELE">DELE</option>
                                <option value="SIELE">SIELE</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>级别</label>
                            <select id="filterLevel" class="filter-select">
                                <option value="">全部</option>
                                <option value="A1">A1</option>
                                <option value="A2">A2</option>
                                <option value="B1">B1</option>
                                <option value="B2">B2</option>
                                <option value="C1">C1</option>
                                <option value="C2">C2</option>
                            </select>
                        </div>
                        <div class="filter-group filter-search">
                            <label>搜索</label>
                            <input type="text" id="filterSearch" placeholder="搜索标题..." class="filter-input">
                        </div>
                        <button class="btn btn-secondary" id="btnApplyFilter">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
                            </svg>
                            <span>筛选</span>
                        </button>
                    </div>

                    <!-- 任务列表 -->
                    <div class="data-table-container">
                        <table class="data-table" id="writingTasksTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>标题</th>
                                    <th>考试类型</th>
                                    <th>级别</th>
                                    <th>字数要求</th>
                                    <th>媒体</th>
                                    <th>创建时间</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="writingTasksBody">
                                <!-- 动态填充 -->
                            </tbody>
                        </table>
                        
                        <div class="table-empty hidden" id="writingTasksEmpty">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/>
                                <polyline points="13 2 13 9 20 9"/>
                            </svg>
                            <p>暂无写作任务</p>
                            <button class="btn btn-primary" onclick="showWritingTaskModal()">创建第一个任务</button>
                        </div>
                        
                        <div class="table-loading hidden" id="writingTasksLoading">
                            <div class="loading-spinner"></div>
                            <p>加载中...</p>
                        </div>
                    </div>

                    <!-- 分页 -->
                    <div class="pagination" id="writingTasksPagination">
                        <!-- 动态填充 -->
                    </div>
                </section>

                <!-- 听力管理页面 -->
                <section class="page-content" id="page-listening">
                    <div class="page-header">
                        <div class="page-header-left">
                            <h2>听力管理</h2>
                            <p>管理听力任务（Tareas）、听力音频与素材库</p>
                        </div>
                        <div class="page-header-right">
                            <button class="btn btn-primary" id="btnAddTarea" onclick="showTareaModal()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"/>
                                    <line x1="5" y1="12" x2="19" y2="12"/>
                                </svg>
                                <span>新建 Tarea</span>
                            </button>
                        </div>
                    </div>

                    <!-- 子视图切换 -->
                    <div class="subtabs">
                        <button class="subtab active" data-view="tareas">Tareas</button>
                        <button class="subtab" data-view="materials">素材库</button>
                    </div>

                    <!-- Tareas 管理视图 -->
                    <div class="listening-view" id="listeningViewTareas">
                        <div class="filter-bar">
                            <div class="filter-group">
                                <label>考试类型</label>
                                <select id="filterListeningExamType" class="filter-select">
                                    <option value="">全部</option>
                                    <option value="DELE">DELE</option>
                                    <option value="SIELE">SIELE</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>级别</label>
                                <select id="filterListeningTareaLevel" class="filter-select">
                                    <option value="">全部</option>
                                    <option value="A1">A1</option>
                                    <option value="A2">A2</option>
                                    <option value="B1">B1</option>
                                    <option value="B2">B2</option>
                                    <option value="C1">C1</option>
                                    <option value="C2">C2</option>
                                </select>
                            </div>
                            <div class="filter-group filter-search">
                                <label>搜索</label>
                                <input type="text" id="filterListeningTareaSearch" placeholder="搜索标题或编号..." class="filter-input">
                            </div>
                            <button class="btn btn-secondary" id="btnApplyListeningTareaFilter">
                                <span>筛选</span>
                            </button>
                        </div>

                        <div class="data-table-container">
                            <table class="data-table" id="listeningTareasTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>标题</th>
                                        <th>考试类型</th>
                                        <th>级别</th>
                                        <th>任务编号</th>
                                        <th>音频数</th>
                                        <th>创建时间</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="listeningTareasBody">
                                    <!-- 动态填充 -->
                                </tbody>
                            </table>

                            <div class="table-empty hidden" id="listeningTareasEmpty">
                                <p>暂无 Tarea</p>
                                <button class="btn btn-primary" onclick="showTareaModal()">创建第一个 Tarea</button>
                            </div>

                            <div class="table-loading hidden" id="listeningTareasLoading">
                                <div class="loading-spinner"></div>
                                <p>加载中...</p>
                            </div>
                        </div>

                        <div class="pagination" id="listeningTareasPagination"></div>
                    </div>

                    <!-- 素材库视图（由 existing listening module 使用相同 ID） -->
                    <div class="listening-view hidden" id="listeningViewMaterials">
                        <div class="filter-bar">
                            <div class="filter-group">
                                <label>级别</label>
                                <select id="filterListeningLevel" class="filter-select">
                                    <option value="">全部</option>
                                    <option value="A1">A1</option>
                                    <option value="A2">A2</option>
                                    <option value="B1">B1</option>
                                    <option value="B2">B2</option>
                                    <option value="C1">C1</option>
                                    <option value="C2">C2</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>口音</label>
                                <select id="filterListeningAccent" class="filter-select">
                                    <option value="">全部</option>
                                    <option value="Latin">Latin</option>
                                    <option value="Castilian">Castilian</option>
                                </select>
                            </div>
                            <div class="filter-group filter-search">
                                <label>搜索</label>
                                <input type="text" id="filterListeningSearch" placeholder="搜索转录/标题..." class="filter-input">
                            </div>
                            <button class="btn btn-secondary" id="btnApplyListeningFilter">
                                <span>筛选</span>
                            </button>
                        </div>

                        <div class="data-table-container">
                            <table class="data-table" id="listeningMaterialsTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>文件名</th>
                                        <th>级别</th>
                                        <th>口音</th>
                                        <th>时长</th>
                                        <th>状态</th>
                                        <th>创建时间</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="listeningMaterialsBody">
                                    <!-- listening.js 填充 -->
                                </tbody>
                            </table>

                            <div class="table-empty hidden" id="listeningMaterialsEmpty">
                                <p>暂无素材</p>
                            </div>

                            <div class="table-loading hidden" id="listeningMaterialsLoading">
                                <div class="loading-spinner"></div>
                                <p>加载中...</p>
                            </div>
                        </div>

                        <div class="pagination" id="listeningMaterialsPagination"></div>
                    </div>

                </section>

                <!-- 阅读材料页面 -->
                <section class="page-content" id="page-reading">
                    <div class="page-header">
                        <div class="page-header-left">
                            <h2>阅读材料管理</h2>
                            <p>管理 SIELE 阅读理解文章和题目</p>
                        </div>
                        <div class="page-header-right">
                            <button class="btn btn-primary" id="btnAddReading">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"/>
                                    <line x1="5" y1="12" x2="19" y2="12"/>
                                </svg>
                                <span>新建文章</span>
                            </button>
                        </div>
                    </div>
                    <div class="coming-soon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                        <h3>即将推出</h3>
                        <p>阅读材料管理功能正在开发中...</p>
                    </div>
                </section>

                <!-- 故事管理页面 -->
                <section class="page-content" id="page-stories">
                    <div class="page-header">
                        <div class="page-header-left">
                            <h2>故事管理</h2>
                            <p>管理西班牙语分级阅读故事</p>
                        </div>
                        <div class="page-header-right">
                            <button class="btn btn-primary" id="btnAddStory">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"/>
                                    <line x1="5" y1="12" x2="19" y2="12"/>
                                </svg>
                                <span>新建故事</span>
                            </button>
                        </div>
                    </div>
                    <div class="coming-soon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                        <h3>即将推出</h3>
                        <p>故事管理功能正在开发中...</p>
                    </div>
                </section>

                <!-- 旅游地点页面 -->
                <section class="page-content" id="page-places">
                    <div class="page-header">
                        <div class="page-header-left">
                            <h2>旅游地点管理</h2>
                            <p>管理西语国家旅游景点内容</p>
                        </div>
                        <div class="page-header-right">
                            <button class="btn btn-primary" id="btnAddPlace">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"/>
                                    <line x1="5" y1="12" x2="19" y2="12"/>
                                </svg>
                                <span>新建地点</span>
                            </button>
                        </div>
                    </div>
                    <div class="coming-soon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                        <h3>即将推出</h3>
                        <p>旅游地点管理功能正在开发中...</p>
                    </div>
                </section>

                <!-- 国家/城市页面 -->
                <section class="page-content" id="page-countries">
                    <div class="page-header">
                        <div class="page-header-left">
                            <h2>国家/城市管理</h2>
                            <p>管理旅游目的地国家和城市</p>
                        </div>
                        <div class="page-header-right">
                            <button class="btn btn-primary" id="btnAddCountry">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"/>
                                    <line x1="5" y1="12" x2="19" y2="12"/>
                                </svg>
                                <span>新建国家</span>
                            </button>
                        </div>
                    </div>
                    <div class="coming-soon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                        <h3>即将推出</h3>
                        <p>国家/城市管理功能正在开发中...</p>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- 写作任务模态框 -->
    <div class="modal-overlay hidden" id="writingTaskModal">
        <div class="modal modal-lg">
            <div class="modal-header">
                <h3 id="writingModalTitle">新建写作任务</h3>
                <button class="modal-close" onclick="closeWritingTaskModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="writingTaskForm">
                    <input type="hidden" id="taskId" name="taskId">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="taskExamType">考试类型 <span class="required">*</span></label>
                            <select id="taskExamType" name="exam_type" required>
                                <option value="DELE">DELE</option>
                                <option value="SIELE">SIELE</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="taskLevel">级别 <span class="required">*</span></label>
                            <select id="taskLevel" name="level" required>
                                <option value="A1">A1</option>
                                <option value="A2">A2</option>
                                <option value="B1">B1</option>
                                <option value="B2">B2</option>
                                <option value="C1">C1</option>
                                <option value="C2">C2</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="taskTitle">任务标题 <span class="required">*</span></label>
                        <input type="text" id="taskTitle" name="title" placeholder="例如：给朋友写一封信" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="taskNumber">任务编号</label>
                            <input type="number" id="taskNumber" name="task_number" placeholder="1" min="1">
                        </div>
                        <div class="form-group">
                            <label for="taskSection">部分名称</label>
                            <input type="text" id="taskSection" name="section" placeholder="Tarea 1">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="taskDescription">题目描述 (HTML)</label>
                        <textarea id="taskDescription" name="description_html" rows="4" placeholder="任务场景描述..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="taskInstructions">写作要求 (HTML)</label>
                        <textarea id="taskInstructions" name="instructions_html" rows="4" placeholder="具体写作指令..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="taskVocabulary">推荐词汇 (HTML)</label>
                        <textarea id="taskVocabulary" name="vocabulary_html" rows="3" placeholder="推荐词汇和短语..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="taskStrategy">破题思路 (HTML)</label>
                        <textarea id="taskStrategy" name="strategy_html" rows="3" placeholder="写作策略和建议..."></textarea>
                    </div>

                    <!-- ✅ [新增] 音频上传区域 -->
                    <div class="form-group">
                        <label>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16" style="vertical-align: middle; margin-right: 4px;">
                                <path d="M9 18V5l12-2v13"/>
                                <circle cx="6" cy="18" r="3"/>
                                <circle cx="18" cy="16" r="3"/>
                            </svg>
                            听力材料
                        </label>
                        <div class="audio-upload-area" id="audioUploadArea">
                            <div class="audio-preview-list" id="audioPreviewList">
                                <!-- 动态填充音频预览 -->
                            </div>
                            <div class="audio-upload-box" id="audioUploadBox">
                                <input type="file" id="taskAudioInput" accept="audio/*" multiple hidden>
                                <div class="upload-placeholder" onclick="document.getElementById('taskAudioInput').click()">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M9 18V5l12-2v13"/>
                                        <circle cx="6" cy="18" r="3"/>
                                        <circle cx="18" cy="16" r="3"/>
                                    </svg>
                                    <span>点击或拖拽上传音频文件</span>
                                    <small>支持 MP3、WAV、M4A、OGG、FLAC、AAC，最大 50MB</small>
                                </div>
                            </div>
                        </div>
                        <div class="audio-upload-hint">
                            <span id="audioCountHint">已关联 0 个音频</span>
                        </div>
                    </div>

                    <!-- 图片上传区域 -->
                    <div class="form-group">
                        <label>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16" style="vertical-align: middle; margin-right: 4px;">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                <circle cx="8.5" cy="8.5" r="1.5"/>
                                <polyline points="21 15 16 10 5 21"/>
                            </svg>
                            任务图片
                        </label>
                        <div class="image-upload-area" id="imageUploadArea">
                            <div class="image-preview-list" id="imagePreviewList">
                                <!-- 动态填充图片预览 -->
                            </div>
                            <div class="image-upload-box" id="imageUploadBox">
                                <input type="file" id="taskImageInput" accept="image/*" multiple hidden>
                                <div class="upload-placeholder" onclick="document.getElementById('taskImageInput').click()">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                        <circle cx="8.5" cy="8.5" r="1.5"/>
                                        <polyline points="21 15 16 10 5 21"/>
                                    </svg>
                                    <span>点击或拖拽上传图片</span>
                                    <small>支持 JPG、PNG、GIF，最大 5MB</small>
                                </div>
                            </div>
                        </div>
                        <div class="image-upload-hint">
                            <span id="imageCountHint">已选择 0 张图片</span>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="taskMinWords">最少字数</label>
                            <input type="number" id="taskMinWords" name="min_words" value="150" min="0">
                        </div>
                        <div class="form-group">
                            <label for="taskMaxWords">最多字数</label>
                            <input type="number" id="taskMaxWords" name="max_words" value="250" min="0">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeWritingTaskModal()">取消</button>
                <button type="button" class="btn btn-primary" id="btnSaveWritingTask">
                    <span class="btn-text">保存</span>
                    <span class="btn-loader hidden">
                        <svg class="spinner" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" fill="none" stroke-dasharray="31.4 31.4" stroke-linecap="round"/>
                        </svg>
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- Tarea 模态框 -->
    <div class="modal-overlay hidden" id="tareaModal">
        <div class="modal modal-sm">
            <div class="modal-header">
                <h3 id="tareaModalTitle">新建 Tarea</h3>
                <button class="modal-close" onclick="closeTareaModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="tareaForm">
                    <input type="hidden" id="tareaId" name="tareaId">
                    <div class="form-group">
                        <label for="tareaExamType">考试类型</label>
                        <select id="tareaExamType" name="exam_type">
                            <option value="DELE">DELE</option>
                            <option value="SIELE">SIELE</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tareaLevel">级别</label>
                        <select id="tareaLevel" name="level">
                            <option value="A1">A1</option>
                            <option value="A2">A2</option>
                            <option value="B1">B1</option>
                            <option value="B2">B2</option>
                            <option value="C1">C1</option>
                            <option value="C2">C2</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tareaNumber">任务编号</label>
                        <input type="number" id="tareaNumber" name="tarea_number" min="1">
                    </div>
                    <div class="form-group">
                        <label for="tareaTitle">标题</label>
                        <input type="text" id="tareaTitle" name="title">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeTareaModal()">取消</button>
                <button type="button" class="btn btn-primary" id="btnSaveTarea">保存</button>
            </div>
        </div>
    </div>

    <!-- Tarea Audios 模态框 -->
    <div class="modal-overlay hidden" id="tareaAudiosModal">
        <div class="modal modal-lg">
            <div class="modal-header">
                <h3 id="tareaAudiosTitle">Tarea 音频</h3>
                <button class="modal-close" onclick="closeTareaAudiosModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div id="tareaAudiosContent">
                    <div class="form-group">
    <label>上传音频（支持多选，最多6个）</label>
    <div id="audioUploadBox" class="file-upload-box" style="border: 2px dashed #e0e0e0; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer;" onclick="document.getElementById('tareaAudioFileInput').click()">
        <input type="file" id="tareaAudioFileInput" accept="audio/*" multiple hidden>
        <div style="color: #5f6368;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 32px; height: 32px; margin-bottom: 8px;">
                <path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/>
            </svg>
            <p style="margin: 0; font-size: 14px;">点击选择或拖拽音频文件到此处</p>
            <small style="color: #999;">支持 MP3/WAV/M4A/OGG 格式，单个最大 50MB</small>
        </div>
    </div>
    <!-- 待上传文件列表（动态生成） -->
    <div id="pendingAudiosList" class="pending-audios-list" style="display: none;"></div>
</div>

<!-- 上传按钮 -->
<div class="form-group">
    <button class="btn btn-primary" id="btnUploadTareaAudio">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; margin-right: 6px;">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="17 8 12 3 7 8"/>
            <line x1="12" y1="3" x2="12" y2="15"/>
        </svg>
        上传并处理
    </button>
</div>

                    <div class="data-table-container">
                        <table class="data-table" id="tareaAudiosTable">
    <thead>
        <tr>
            <th style="width:50px;">序号</th>
            <th>标题</th>
            <th style="width:80px;">状态</th>
            <th style="width:100px;">素材ID</th>
            <th style="width:60px;">排序</th>
            <th style="width:80px;">操作</th>
        </tr>
    </thead>
    <tbody id="tareaAudiosBody"></tbody>
</table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeTareaAudiosModal()">关闭</button>
            </div>
        </div>
    </div>

    

    <!-- 确认删除模态框 -->
    <div class="modal-overlay hidden" id="confirmDeleteModal">
        <div class="modal modal-sm">
            <div class="modal-header">
                <h3>确认删除</h3>
                <button class="modal-close" onclick="closeConfirmDeleteModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="confirm-message">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="12"/>
                        <line x1="12" y1="16" x2="12.01" y2="16"/>
                    </svg>
                    <p>您确定要删除此项目吗？此操作无法撤销。</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeConfirmDeleteModal()">取消</button>
                <button type="button" class="btn btn-danger" id="btnConfirmDelete">删除</button>
            </div>
        </div>
    </div>
    <!-- ==================== 题目管理模态框 ==================== -->
<!-- ==================== 题目管理模态框 (v2.0) ==================== -->
<!-- 替换 admin.html 中原有的 tareaQuestionsModal -->

<!-- Tarea Questions 模态框 - 可视化编辑器 -->
<div class="modal-overlay hidden" id="tareaQuestionsModal">
    <div class="modal modal-xl">
        <div class="modal-header">
            <h3 id="tareaQuestionsTitle">Tarea 题目管理</h3>
            <button class="modal-close" onclick="closeTareaQuestionsModal()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <!-- 工具栏 -->
            <div class="questions-toolbar">
                <div class="toolbar-left">
                    <div class="form-group-inline">
                        <label>版本</label>
                        <select id="tareaQuestionsVersion"></select>
                    </div>
                    <button class="btn btn-sm btn-danger" id="btnDeleteTareaQuestionsVersion">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:14px;height:14px;margin-right:4px">
                            <polyline points="3 6 5 6 21 6"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        </svg>
                        删除版本
                    </button>
                </div>
                <div class="toolbar-right">
                    <button class="btn btn-sm btn-secondary" id="btnToggleEditMode">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:14px;height:14px;margin-right:4px">
                            <polyline points="16 18 22 12 16 6"/>
                            <polyline points="8 6 2 12 8 18"/>
                        </svg>
                        <span>JSON 模式</span>
                    </button>
                </div>
            </div>

            <!-- 可视化编辑器容器 -->
            <div id="tareaQuestionsVisualEditor" class="questions-visual-editor">
                <!-- 由 JS 动态渲染 -->
            </div>

            <!-- JSON 编辑器 (默认隐藏) -->
            <textarea id="tareaQuestionsJsonEditor" class="questions-json-editor hidden" rows="20" 
                placeholder='{"version": 1, "instructions": {"es": "", "zh": ""}, "questions": []}'></textarea>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeTareaQuestionsModal()">取消</button>
            <button type="button" class="btn btn-primary" id="btnSaveTareaQuestions">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;margin-right:6px">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                    <polyline points="17 21 17 13 7 13 7 21"/>
                    <polyline points="7 3 7 8 15 8"/>
                </svg>
                保存题目
            </button>
        </div>
    </div>
</div>



    <script src="js/config.js"></script>
    <script src="js/admin.js"></script>
    <script src="js/writing.js"></script>
    <script src="js/listening.js"></script>
    <script src="js/listening_admin.js"></script>
    <script src="js/listening_tareas.js"></script>
    <script src="js/listening_questions.js"></script>
</body>
</html>